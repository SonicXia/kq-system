<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>jquery 的基本控件</title>
    <meta charset="utf-8"/>
    <!--jquery的主文件-->
    <script type="text/javascript" src="/skin/js/jquery-easyui-1.3.5/jquery.min.js"></script>
    <!--jquery easyui的文件-->
    <script type="text/javascript" src="/skin/js/jquery-easyui-1.3.5/jquery.easyui.min.js"></script>
    <!--jquery 的主样式文件-->
    <link type="text/css" rel="stylesheet" href="/skin/js/jquery-easyui-1.3.5/themes/default/easyui.css">
    <!--jquery的图标文件-->
    <link type="text/css" rel="stylesheet" href="/skin/js/jquery-easyui-1.3.5/themes/icon.css">
    <!--国际化,中文包-->
    <script type="text/javascript" src="/skin/js/jquery-easyui-1.3.5/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/skin/js/dateformat.js"></script>
    <style type="text/css">
        #fm {
            margin: 0;
            padding: 10px 30px;
        }
        .ftitle {
            font-size: 14px;
            font-weight: bold;
            padding: 5px 0;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
        }
        .fitem {
            margin-bottom: 5px;
        }
        .fitem label {
            display: inline-block;
            width: 100px;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            /**
             * 界面会传过去2个参数,第一个参数是当前页page,第二个参数每页显示多少条rows
             *
             *
             */
            $("#datagrid").datagrid({
                columns: [[
                    {checkbox: true},//复选框
                    {title: "加班日期", width: 100, field: 'workDate',formatter: formatDatebox_day},
                    {title: "开始时间", width: 100, field: 'startTime'},
                    {title: "结束时间", width: 100, field: 'endTime'},
                    {title: "总计(单位:小时)", width: 100, field: 'totalHouse'},
                    {title: "创建时间", width: 100, field: 'createTime',formatter: formatDatebox_time},
                    {title: "备注", width: 100, field: 'note'},
                ]],
                fitColumns: true,
                url: "/kqs/overtime/getOvertimeDatas.do",
                toolbar: [
                    {
                        text: "新增",
                        iconCls: 'icon-add',
                        handler: function () {
                            newuser();
                        }
                    },"-",
                    {
                        text: "删除",
                        iconCls: 'icon-remove',
                        handler: function () {
                            destroyUser();
                        }
                    }
                ],
                onLoadSuccess: function () {
                    $("#btn").linkbutton({
                        iconCls: "icon-add"
                    });
                }, // 加载数据后执行
                onDblClickRow: function (rowIndex, rowData) {
                    edituser(rowData);
                },
                loadMsg: "数据正在加载,请稍后...", // 加载数据中,提示信息
                method: "POST",
                pagination: true,// 分页工具栏
                rownumbers: true, // 显示行号
//                singleSelect:true // 只能单选 (和复选框不可共用)
                striped: true // 显示斑马线效果
            });
        });
    </script>
</head>
<body>
<table id="datagrid"></table>
<div id="dlg" class="easyui-dialog" style="width: 450px; height: 320px; padding: 10px 20px;"
     closed="true" buttons="#dlg-buttons">
    <form id="fm" method="post">
        <input type="hidden" name="id" id="id" />
        <div class="fitem">
            <label>加班日期</label>
            <input name="workDateStr" class="easyui-datebox" required="true" data-options="sharedCalendar:'#cc'" style="width:180px;"/>
        </div>
        <div class="fitem">
            <label>开始时间</label>
            <input name="startTime" class="easyui-timespinner" style="width:180px;">
        </div>
        <div class="fitem">
            <label>结束时间</label>
            <input name="endTime" class="easyui-timespinner" style="width:180px;">
        </div>
        <div class="fitem">
            <label>总计(单位:小时)</label>
            <input name="totalHouse" class="input easyui-numberbox" min="0.5" value="1" max="12" precision="1" type="text" style="width:180px;" />
        </div>
        <div class="fitem">
            <label>备注</label>
            <input name="note" class="easyui-vlidatebox" data-options="multiline:true" style="width:180px;height:60px" />
        </div>
    </form>
    <div id="cc" class="easyui-calendar"></div>
</div>
<div id="dlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="saveuser()" iconcls="icon-save">保存</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="javascript:$('#dlg').dialog('close')"
       iconcls="icon-cancel">取消</a>
</div>
<script type="text/javascript">
    var url;
    var type;
    function newuser() {
        $("#dlg").dialog("open").dialog('setTitle', '新增加班记录'); ;
        $("#fm").form("clear");
        url = "/kqs/overtime/add.do";
    }
    function edituser(row) {
        console.log(row);
        if (row) {
            $("#dlg").dialog("open").dialog('setTitle', '编辑加班记录');
            $('#ff').form('clear');
            $("#fm").form("load", "/kqs/overtime/edit.do?id=" + row.id);
            url = "/kqs/overtime/edit.do";
        }
    }
    function saveuser() {
        $("#fm").form("submit", {
            url: url,
            onsubmit: function () {
                return $(this).form("validate");
            },
            success: function (data) {
                var jsondata = null;//eval('(' + data + ')');
                if (data instanceof Object){
                    jsondata = data;
                }else{
                    jsondata = eval('(' + data + ')');
                }
                if (jsondata.status == 200){
                    $.messager.alert('操作提示', jsondata.message, 'info', function(){
                        $("#dlg").dialog("close");
                        $("#datagrid").datagrid("reload");
                    });
                }else{
                    $.messager.alert('操作提示', jsondata.message, 'error');
                }
            }
        });
    }
    function destroyUser() {
       // var row = $('#datagrid').datagrid('getSelected');//返回选中一行 这个是注释过的  就是取一个
        var row = $('#datagrid').datagrid("getSelections");//返回选中多行
        //判断是否选中行
        if (row.length==0) {
            $.messager.alert("提示", "请选择要删除的行！", "info");
            return;
        }else{
            console.log(row);
            if (row) {
                $.messager.confirm('Confirm', '你确定删除吗?', function (r) {
                    if (r) {
                        var ids= "";
                        for (var i = 0; i < row.length; i++) {
                            ids += row[i].id + ",";
                        }
                        console.log(ids);
                        $.post('/kqs/overtime/del.do', { ids: ids}, function (data) {
                            var jsondata = null;//eval('(' + data + ')');
                            if (data instanceof Object){
                                jsondata = data;
                            }else{
                                jsondata = eval('(' + data + ')');
                            }
                            if (jsondata.status == 200) {
                                $.messager.alert('操作提示', jsondata.message, 'info', function(){
                                    $('#datagrid').datagrid('reload');    // reload the user data
                                });
                            } else {
                                $.messager.show({   // show error message
                                    title: '异常提示',
                                    msg: jsondata.message
                                });
                            }
                        }, 'json');
                    }
                });
            }
        }
    }
</script>
</body>
</html>